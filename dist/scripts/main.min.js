/*!
 *
 *  Web Starter Kit
 *  Copyright 2015 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
!function(){"use strict";"serviceWorker"in navigator&&("https:"===window.location.protocol||"localhost"===window.location.hostname||0===window.location.hostname.indexOf("127."))&&navigator.serviceWorker.register("/service-worker.js",{scope:"./"}).then(function(e){"function"==typeof e.update&&e.update(),e.onupdatefound=function(){if(navigator.serviceWorker.controller){var t=e.installing;t.onstatechange=function(){switch(t.state){case"installed":break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}})["catch"](function(e){console.error("Error during service worker registration:",e)})}();var GAME;!function(e){"use strict";var t;!function(e){var t;!function(e){e.art=["images/gameart/asteroid_large_animated.png","images/gameart/asteroid_medium_animated.png","images/gameart/asteroid_small_animated.png","images/gameart/debris2_blue.png","images/gameart/double_ship.png","images/gameart/explosion.hasgraphics.png","images/gameart/explosion_alpha.png","images/gameart/nebula_blue.f2014.png","images/gameart/shot2.png","images/gameart/splash.png"]}(t=e.Images||(e.Images={}))}(t=e.Assets||(e.Assets={}))}(GAME||(GAME={}));var GAME;!function(e){"use strict";var t=function(){function e(e,t){this._x=e,this._y=t}return e.angleToVector2d=function(t){return new e(Math.cos(t),Math.sin(t))},e.distance=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e.prototype.set=function(e,t){this._x=e,this._y=t},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),e}();e.Vector2d=t}(GAME||(GAME={}));var GAME;!function(e){"use strict";var t=function(){function e(e,t){this.animationSpeed=e,this.numberOfFrames=t}return e}();e.AnimationInfo=t;var i=function(){function e(e,t,i,n){void 0===n&&(n=0),this.url=e,this.width=t,this.height=i,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.radius=n}return e}();e.SpriteInfo=i;var n=function(){function e(){}return e.explosionAnimationInfo=new t(1,64),e.explosionSpriteInfo=new i("images/gameart/explosion.hasgraphics.png",100,100),e.shieldDamageAnimationInfo=new t(2,24),e.shieldDamageSpriteInfo=new i("images/gameart/explosion_alpha.png",128,128),e.asteroidAnimationInfo=new t(3,24),e.asteroidLargeSpriteInfo=new i("images/gameart/asteroid_large_animated.png",96,96,26),e.asteroidMediumSpriteInfo=new i("images/gameart/asteroid_medium_animated.png",72,72,17),e.asteroidSmallSpriteInfo=new i("images/gameart/asteroid_small_animated.png",48,48,13),e.missileSpriteInfo=new i("images/gameart/shot2.png",10,10,9),e.shipSpriteInfo=new i("images/gameart/double_ship.png",90,90,30),e.backgroundSpriteInfo=new i("images/gameart/nebula_blue.f2014.png",800,600),e.debrisFieldSpriteInfo=new i("images/gameart/debris2_blue.png",640,480),e.splashSpriteInfo=new i("images/gameart/splash.png",400,300),e}();e.SpriteConfigs=n}(GAME||(GAME={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},GAME;!function(e){"use strict";var t=function(){function t(t,i,n,r){void 0===r&&(r=!0),this.render=function(e){throw{error:"Sprite render() not implemented",message:"Implement render function in subclass"}},this.update=function(){throw{error:"Sprite update() not implemented",message:"Implement update function in subclass"}},this.spriteInfo=t,this.position=new e.Vector2d(i,n),this.visible=r,this.active=!0}return t}();e.Sprite=t;var i=function(t){function i(i,n,r,s){var o=this;t.call(this,i,r,s,!0),this.render=function(t){var i,n,r=e.Resources.instance.getImage(o.spriteInfo.url);if(o.visible){if(o.frame===o.animationInfo.numberOfFrames)return o.finished=!0,void(o.visible=!1);o.tickCount+=1,o.tickCount%o.animationInfo.animationSpeed===0&&(o.frame+=1),i=o.frame%9*o.spriteInfo.width,n=Math.floor(o.frame/9)*o.spriteInfo.height,t.save(),t.translate(o.position.x,o.position.y),r&&t.drawImage(r,i,n,o.spriteInfo.width,o.spriteInfo.height,-o.spriteInfo.halfWidth,-o.spriteInfo.halfHeight,o.spriteInfo.width,o.spriteInfo.height),t.restore()}},this.animationInfo=n,this.frame=0,this.tickCount=-1,this.finished=!1}return __extends(i,t),i}(t);e.Effect=i;var n=function(t){function i(i,n,r){var s=this;t.call(this,i,n,r),this.render=function(t){t.save();var i=e.Resources.instance.getImage(s.spriteInfo.url);i&&t.drawImage(i,0,0,s.spriteInfo.width,s.spriteInfo.height,0,0,e.SCREEN_WIDTH,e.SCREEN_HEIGHT),t.restore()}}return __extends(i,t),i}(t);e.Background=n;var r=function(t){function i(i,n,r){var s=this;t.call(this,i,n,r),this.render=function(t){t.save();var i=e.Resources.instance.getImage(s.spriteInfo.url);i&&t.drawImage(i,0,0,s.spriteInfo.width,s.spriteInfo.height,s.position.x-s.spriteInfo.halfWidth,s.position.y-s.spriteInfo.halfHeight,s.spriteInfo.width,s.spriteInfo.height),t.restore()}}return __extends(i,t),i}(t);e.Splash=r;var s=function(t){function i(i,n,r){var s=this;t.call(this,i,n,r),this.render=function(t){var i=e.Resources.instance.getImage(s.spriteInfo.url),n=2,r=s.position.x;if(i)for(;n>0;)t.save(),t.translate(r,s.position.y),t.drawImage(i,0,0,s.spriteInfo.width,s.spriteInfo.height,0,0,e.SCREEN_WIDTH,e.SCREEN_HEIGHT),t.restore(),r-=e.SCREEN_WIDTH,n-=1},this.update=function(){s.position.x+=1,s.position.x>=e.SCREEN_WIDTH&&(s.position.x-=e.SCREEN_WIDTH)}}return __extends(i,t),i}(t);e.DebrisField=s;var o=function(t){function i(i,n,r){var s=this;t.call(this,i,n,r),this.wrap=function(){s.position.x<0?s.position.x=e.SCREEN_WIDTH-s.position.x:s.position.x>e.SCREEN_WIDTH&&(s.position.x=s.position.x-e.SCREEN_WIDTH),s.position.y<0?s.position.y=e.SCREEN_HEIGHT-s.position.y:s.position.y>e.SCREEN_HEIGHT&&(s.position.y=s.position.y-e.SCREEN_HEIGHT)},this.render=function(t){if(s.visible){t.save(),t.translate(s.position.x,s.position.y),t.rotate(s.angle);var i=e.Resources.instance.getImage(s.spriteInfo.url);i&&t.drawImage(i,0,0,s.spriteInfo.width,s.spriteInfo.height,-s.spriteInfo.halfWidth,-s.spriteInfo.halfHeight,s.spriteInfo.width,s.spriteInfo.height),t.restore()}},this.update=function(){s.preUpdate(),s.active&&(s.angle+=s.angularVelocity,s.position.x+=s.velocity.x,s.position.y+=s.velocity.y,s.wrap(),s.postUpdate())},this.preUpdate=function(){},this.postUpdate=function(){},this.velocity=new e.Vector2d(0,0),this.angle=0,this.angularVelocity=0,this.radius=i.radius}return __extends(i,t),i}(t);e.SimulationObject=o;var a=function(e){function t(t,i,n){var r=this;e.call(this,t,i,n),this.preUpdate=function(){return r.ticksToLive-=1,r.ticksToLive<=0?(r.active=!1,void(r.visible=!1)):void 0},this.ticksToLive=60}return __extends(t,e),t}(o);e.Missile=a;var c=function(t){function i(i,n,r,s,o,a){var c=this;t.call(this,i,r,s),this.render=function(t){var i,n,r=e.Resources.instance.getImage(c.spriteInfo.url);c.visible&&(c.frame===c.animationInfo.numberOfFrames&&(c.frame=0),c.tickCount+=1,c.tickCount%c.animationInfo.animationSpeed===0&&(c.frame+=1),i=c.frame%9*c.spriteInfo.width,n=0,t.save(),t.translate(c.position.x,c.position.y),r&&t.drawImage(r,i,n,c.spriteInfo.width,c.spriteInfo.height,-c.spriteInfo.halfWidth,-c.spriteInfo.halfHeight,c.spriteInfo.width,c.spriteInfo.height),t.restore())},this.animationInfo=n,this.frame=0,this.tickCount=-1,this.finished=!1,this.damage=o,this.points=a}return __extends(i,t),i}(o);e.Asteroid=c;var h=function(t){function i(i,n,r){var s=this;t.call(this,i,n,r),this.render=function(t){var i=e.Resources.instance.getImage(s.spriteInfo.url);t.save(),t.translate(s.position.x,s.position.y),t.rotate(s.angle),i&&t.drawImage(i,s.thrusting?s.spriteInfo.width:0,0,s.spriteInfo.width,s.spriteInfo.height,-s.spriteInfo.halfWidth,-s.spriteInfo.halfHeight,s.spriteInfo.width,s.spriteInfo.height),t.restore()},this.postUpdate=function(){var t;s.thrusting&&(t=e.Vector2d.angleToVector2d(s.angle),s.velocity.x+=t.x*s.accelerationClamp,s.velocity.y+=t.y*s.accelerationClamp),s.velocity.x*=s.friction,s.velocity.y*=s.friction},this.accelerationClamp=.3,this.friction=.95,this.thrusting=!1,this.maxShields=100,this._shields=this.maxShields,this.score=0,this.angle=1.5*Math.PI}return __extends(i,t),Object.defineProperty(i.prototype,"shields",{get:function(){return this._shields},set:function(e){this._shields=e,this._shields<0&&(this._shields=0)},enumerable:!0,configurable:!0}),i.prototype.getShieldPercentage=function(){return this.shields/this.maxShields},i}(o);e.Ship=h;var p=function(){function t(){}return t.getSprite=function(t,o,p){switch(t){case"asteroid-small":return new c(e.SpriteConfigs.asteroidSmallSpriteInfo,e.SpriteConfigs.asteroidAnimationInfo,o,p,2,100);case"asteroid-medium":return new c(e.SpriteConfigs.asteroidMediumSpriteInfo,e.SpriteConfigs.asteroidAnimationInfo,o,p,4,200);case"asteroid-large":return new c(e.SpriteConfigs.asteroidLargeSpriteInfo,e.SpriteConfigs.asteroidAnimationInfo,o,p,6,300);case"missile":return new a(e.SpriteConfigs.missileSpriteInfo,o,p);case"ship":return new h(e.SpriteConfigs.shipSpriteInfo,o,p);case"explosion":return new i(e.SpriteConfigs.explosionSpriteInfo,e.SpriteConfigs.explosionAnimationInfo,o,p);case"shield-damage":return new i(e.SpriteConfigs.shieldDamageSpriteInfo,e.SpriteConfigs.shieldDamageAnimationInfo,o,p);case"background":return new n(e.SpriteConfigs.backgroundSpriteInfo,o,p);case"debris-field":return new s(e.SpriteConfigs.debrisFieldSpriteInfo,o,p);case"splash":return new r(e.SpriteConfigs.splashSpriteInfo,o,p);default:throw{error:"Invalid Sprite Type",message:"No such sprite type exists"}}},t}();e.SpriteMaker=p}(GAME||(GAME={}));var GAME;!function(e){"use strict";var t=function(){function e(){var t=this;if(this.pushRenderFunction=function(e){t.renderFunctionList.push(e)},this.render=function(){t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.renderFunctionList.forEach(function(e){e(t.context)})},this.renderFunctionList=[],this.context=null,this.canvas=null,e._instance)throw new Error(e.ERROR_DO_NOT_CALL_CONSTRUCTOR);e._instance=this}return Object.defineProperty(e,"instance",{get:function(){return null===e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.setContext=function(e){this.context=e},e.prototype.setCanvas=function(e){this.canvas=e},e.prototype.flush=function(){this.renderFunctionList=[]},e.ERROR_DO_NOT_CALL_CONSTRUCTOR="Error: Instantiation failed: Use Resources.instance instead of new.",e._instance=null,e}();e.Renderer=t}(GAME||(GAME={}));var GAME;!function(e){"use strict";var t=function(){function e(){var t=this;if(this.getImage=function(e){return t.resourceCache[e]},this.isReady=function(){for(var e in t.resourceCache)if(t.resourceCache.hasOwnProperty(e)&&!t.resourceCache[e])return!1;return!0},this.onReady=function(e){t.readyCallbacks.push(e)},this.load=function(e){var i=t;e instanceof Array?e.forEach(function(e){i.loadInternally(e)}):t.loadInternally(e)},this.loadInternally=function(e){var i=t,n=null;return t.resourceCache[e]?t.resourceCache[e]:(n=new Image,n.onload=function(){i.resourceCache[e]=n,i.isReady()&&i.readyCallbacks.forEach(function(e){e()})},t.resourceCache[e]=!1,n.src=e,void 0)},e._instance)throw new Error("Error: Instantiation failed: Use Resources.instance instead of new.");this.resourceCache={},this.readyCallbacks=[],e._instance=this}return Object.defineProperty(e,"instance",{get:function(){return null===e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e._instance=null,e}();e.Resources=t}(GAME||(GAME={}));var GAME;!function(e){"use strict";function t(e,t){return Math.floor(Math.random()*(t-e+1))+e}var i;!function(e){e[e.RUNNING=0]="RUNNING",e[e.SPLASH=1]="SPLASH"}(i||(i={}));var n;!function(e){e[e.space=32]="space",e[e.left=37]="left",e[e.up=38]="up",e[e.right=39]="right",e[e.down=40]="down"}(n||(n={})),e.SCREEN_WIDTH=800,e.SCREEN_HEIGHT=800;var r=function(){function r(){var s=this;this.init=function(){s.reset()},this.main=function(){switch(window.requestAnimationFrame(s.main),s.gameState){case i.SPLASH:s.updateSplash(0),s.render();break;case i.RUNNING:s.update(0),s.collisionDetection(),s.render(),s.cleanup();break;default:throw{error:"Invalid Game State",message:"Check the GameState enumeration for valid states"}}},this.cleanup=function(){var e,t,i;for(i=[],e=s.effects.length,t=0;e>t;t++)s.effects[t].active&&i.push(s.effects[t]);for(s.effects=i,i=[],e=s.asteroids.length,t=0;e>t;t++)s.asteroids[t].active&&i.push(s.asteroids[t]);for(s.asteroids=i,i=[],e=s.missiles.length,t=0;e>t;t++)s.missiles[t].active&&i.push(s.missiles[t]);s.missiles=i},this.updateSplash=function(){e.Renderer.instance.pushRenderFunction(s.background.render),s.debrisField.update(),e.Renderer.instance.pushRenderFunction(s.debrisField.render),e.Renderer.instance.pushRenderFunction(s.splash.render),e.Renderer.instance.pushRenderFunction(s.renderUI)},this.update=function(){e.Renderer.instance.pushRenderFunction(s.background.render),s.debrisField.update(),e.Renderer.instance.pushRenderFunction(s.debrisField.render),s.missiles.forEach(function(t){t.active&&(t.update(),e.Renderer.instance.pushRenderFunction(t.render))}),s.player.update(),e.Renderer.instance.pushRenderFunction(s.player.render),s.asteroids.forEach(function(t){t.active&&(t.update(),e.Renderer.instance.pushRenderFunction(t.render))}),s.effects.forEach(function(t){t.active&&e.Renderer.instance.pushRenderFunction(t.render)}),s.spawnTickCounter-=1,s.spawnTickCounter<0&&(s.spawnAsteroid(),s.spawnTickCounter=r.ASTEROID_RESPAWN_TIME),e.Renderer.instance.pushRenderFunction(s.renderUI)},this.render=function(){e.Renderer.instance.render(),e.Renderer.instance.flush()},this.spawnAsteroid=function(){var i,n=t(1,3);i=1===n?e.SpriteMaker.getSprite("asteroid-large",0,0):2===n?e.SpriteMaker.getSprite("asteroid-medium",0,0):e.SpriteMaker.getSprite("asteroid-small",0,0);var r=t(1,2),o=t(1,2);r=1===r?0:e.SCREEN_WIDTH,o=1===o?0:e.SCREEN_HEIGHT,i.position.x=r,i.position.y=o,i.velocity.x=t(-300,300)/100,i.velocity.y=t(-300,300)/100,i.angularVelocity=t(-10,10)/100,i.active=!0,s.asteroids.push(i)},this.collisionDetection=function(){var t,n,o,a,c=s.missiles,h=s.asteroids.length,p=c.length,u=s.player;for(t=0;h>t;t++)if(a=s.asteroids[t],u.active&&a.active&&r.collided(u,a)&&(a.active=!1,s.effects[s.effects.length]=e.SpriteMaker.getSprite("shield-damage",u.position.x,u.position.y),s.effects[s.effects.length]=e.SpriteMaker.getSprite("explosion",a.position.x,a.position.y),new Audio("audio/explosion.mp3").play(),s.player.shields-=a.damage,s.player.score+=a.points),a.active)for(n=0;p>n;n++)o=c[n],o.active&&r.collided(o,a)&&(o.active=!1,a.active=!1,s.effects[s.effects.length]=e.SpriteMaker.getSprite("explosion",a.position.x,a.position.y),new Audio("audio/explosion.mp3").play(),s.player.score+=a.points);return s.player.score>s.highScore&&(s.highScore=s.player.score),0===s.player.shields?(s.gameState=i.SPLASH,void s.reset()):void 0},this.handleInput=function(e){var t=e.type.toString(),r=e.keyCode;if("mousedown"===t&&s.gameState===i.SPLASH&&(s.gameState=i.RUNNING),"keydown"===t)switch(n[r]){case"left":s.player.angularVelocity=-.1;break;case"right":s.player.angularVelocity=.1;break;case"up":s.player.thrusting=!0}if("keyup"===t)switch(n[r]){case"left":case"right":s.player.angularVelocity=0;break;case"up":s.player.thrusting=!1;break;case"space":s.shoot()}},this.renderUI=function(t){var i=.2*e.SCREEN_WIDTH,n=20,r=e.SCREEN_WIDTH/2-i/2,o=20,a=4,c=s.player.getShieldPercentage();t.save(),t.fillStyle=s.getShieldRGBA(),t.fillRect(r+(i-i*c),o,i*c,n),t.restore(),t.save(),t.font="18px Arial",t.textAlign="left",t.fillStyle="white",t.fillText(Math.floor(100*c).toString()+"%",r+a,o+4*a),t.stroke(),t.restore(),t.save(),t.lineWidth=a,t.strokeStyle="rgba(255,255,255,0.75)",t.strokeRect(r,o,i,n),t.restore(),t.save(),t.font="20px Arial",t.fillStyle="rgba(255,255,255,0.75)",t.fillText("Score: "+s.player.score,20,37),t.fillText("Hi: "+s.highScore,e.SCREEN_WIDTH-t.measureText("Hi: "+s.highScore).width-20,37),t.restore()},e.Resources.instance.load(e.Assets.Images.art),this.asteroids=[],this.effects=[],this.missiles=[],this.background=e.SpriteMaker.getSprite("background",0,0),this.debrisField=e.SpriteMaker.getSprite("debris-field",0,0),this.player=e.SpriteMaker.getSprite("ship",e.SCREEN_WIDTH/2,e.SCREEN_HEIGHT/2),this.gameState=i.SPLASH,this.soundTrack=new Audio("audio/soundtrack.mp3"),this.soundTrack.loop=!0,this.highScore=0,this.spawnTickCounter=r.ASTEROID_RESPAWN_TIME,this.splash=e.SpriteMaker.getSprite("splash",e.SCREEN_WIDTH/2,e.SCREEN_HEIGHT/2),document.addEventListener("keyup",this.handleInput),document.addEventListener("keydown",this.handleInput),document.addEventListener("mousedown",this.handleInput)}return r.collided=function(t,i){return e.Vector2d.distance(t.position,i.position)<t.radius+i.radius},r.prototype.getShieldRGBA=function(){var e,t,i,n=0,r=.75,s=this.player.getShieldPercentage();return Math.floor(100*s)>50?(e=2*(255-Math.floor(255*s)),t=255):(e=255,t=2*Math.floor(255*s)),i=[e,t,n,r],"rgba("+i.join(",")+")"},r.prototype.reset=function(){this.asteroids=[],this.effects=[],this.missiles=[],this.background=e.SpriteMaker.getSprite("background",0,0),this.player=e.SpriteMaker.getSprite("ship",e.SCREEN_WIDTH/2,e.SCREEN_HEIGHT/2),this.soundTrack.currentTime=0},r.prototype.shoot=function(){var t,i=this.player,n=e.SpriteMaker.getSprite("missile",0,0);t=e.Vector2d.angleToVector2d(this.player.angle),n.position.set(i.position.x+i.radius*t.x,i.position.y+i.radius*t.y),n.velocity.set(i.velocity.x+6*t.x,i.velocity.y+6*t.y),n.angle=i.angle,this.missiles.push(n),new Audio("audio/missile.mp3").play()},r.ASTEROID_RESPAWN_TIME=15,r}();e.RiceRocks=r}(GAME||(GAME={})),window.onload=function(){var e=new GAME.RiceRocks,t=document,i=t.createElement("canvas"),n=i.getContext("2d");i.width=GAME.SCREEN_WIDTH,i.height=GAME.SCREEN_HEIGHT,t.body.appendChild(i),GAME.Renderer.instance.setCanvas(i),GAME.Renderer.instance.setContext(n),GAME.Resources.instance.onReady(e.init),e.main()};